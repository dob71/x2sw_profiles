# .pronsolerc file for X2
!print "Loaded " + self.rc_filename
# Multiple extruder init
!self._extruder = 0
# Support both SF and Slic3r skeiners
!self.sf_slicecommand="python skeinforge/skeinforge_application/skeinforge_utilities/skeinforge_craft.py $s"
!self.sf_sliceoptscommand="python skeinforge/skeinforge_application/skeinforge.py"
!self.slic3rcmd = os.path.join(os.path.abspath(os.path.dirname(sys.argv[0])), 'slic3r','slic3r')
!if os.path.exists(os.path.join(os.path.abspath(os.path.dirname(sys.argv[0])), 'slic3r','slic3r.pl')): self.slic3rcmd = 'perl ' + os.path.join(os.path.abspath(os.path.dirname(sys.argv[0])), 'slic3r','slic3r.pl')
!self.slic3r_slicecommand=self.slic3rcmd + " $s --output $o"
!self.slic3r_sliceoptscommand=self.slic3rcmd
!self.settings.slicecommand = self.slic3r_slicecommand
!self.settings.sliceoptscommand = self.slic3r_sliceoptscommand
!self.slicemode = 'slic3r'

set xy_feedrate 3000
set z_feedrate 300
set e_feedrate 100
set last_temperature 175.0
set last_bed_temperature 78.0
set temperature_abs 210
set bedtemp_abs 115
set temperature_pla 177
set bedtemp_pla 78
set build_dimensions 200x200x125

macro onConnect
  !self._extruder = 0
  !self.onecmd('button 0 "Ext 0" /c green extruder0')
  !self.onecmd('button 1 "Ext 1" /c lightgrey extruder1')

macro onDisconnect
  !self._extruder = 0
  !self.onecmd('button 0 "Ext 0" /c lightgrey extruder0')
  !self.onecmd('button 1 "Ext 1" /c lightgrey extruder1')

macro onReset
  !self._extruder = 0
  !self.onecmd('button 0 "Ext 0" /c lightgrey extruder0')
  !self.onecmd('button 1 "Ext 1" /c lightgrey extruder1')

macro extruder0
  T0

macro extruder1
  T1

macro onSetExt0
  !self._extruder = 0
  !self.onecmd('button 0 "Ext 0" /c green extruder0')
  !self.onecmd('button 1 "Ext 1" /c lightgrey extruder1')
button 0 "Ext 0" /c "lightgrey" extruder0

macro onSetExt1
  !self._extruder = 1
  !self.onecmd('button 1 "Ext 1" /c green extruder1')
  !self.onecmd('button 0 "Ext 0" /c lightgrey extruder0')
button 1 "Ext 1" /c "lightgrey" extruder1

macro fanoff
   M107
button 4 "fan off" /c "lightgrey" fanoff

macro fan70
   M106
   !time.sleep(1.0)
   M106 S70
button 5 "fan 50%" /c "lightgrey" fan70

macro fan120
   M106
   !time.sleep(1.0)
   M106 S120
button 6 "fan 100%" /c "lightgrey" fan120

macro resetSD
   M22
   !time.sleep(0.2)
   M21
   !time.sleep(0.2)
   M20
button 7 "ResetSD" /c "lightgrey" resetSD

macro x2Merge
   !try:
   !    from X2MergeDialog import X2MergeDialog
   !    dlg = X2MergeDialog(self)
   !    res = dlg.ShowModal()
   !    if (res == 1):
   !         self.loadfile(None, filename=dlg.GetPath())
   !    if (res == 2):
   !         self.status.SetStatusText(_("The merge has failed!"))
   !except:
   !    self.status.SetStatusText(_("The merge cannot be completed!"))
   !    pass
button 8 "X2Merge" /c "lightgrey" x2Merge

macro changeSkeiner
   !try:
   !  if self.slicemode == 'sf':
   !    self.onecmd('button 9 "Use Skeinforge" /c lightgrey changeSkeiner')
   !    self.slicemode = 'slic3r'
   !    self.settings.slicecommand = self.slic3r_slicecommand
   !    self.settings.sliceoptscommand = self.slic3r_sliceoptscommand
   !    self.status.SetStatusText(_("Switched to Slic3r"))
   !  else:
   !    self.onecmd('button 9 "Use Slic3r" /c lightgrey changeSkeiner')
   !    self.slicemode = 'sf'
   !    self.settings.slicecommand = self.sf_slicecommand
   !    self.settings.sliceoptscommand = self.sf_sliceoptscommand
   !    self.status.SetStatusText(_("Switched to Skeinforge"))
   !except:
   !  self.status.SetStatusText(_("Failed to change skeiner!"))
   !  pass
button 9 "Use Skeinforge" /c "lightgrey" changeSkeiner

